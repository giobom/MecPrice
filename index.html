<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z51NZDH621"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Z51NZDH621');
</script>

  <title>MecPrice - Orçamentos Automotivos</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#facc15" />
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png" />

  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <header class="topbar">
    <h1>MecPrice</h1>
    <p class="subtitle">Orçamentos automotivos rápidos e profissionais</p>
  </header>

  <main class="container">

    <!-- ABAS -->
    <nav class="tabs" aria-label="Navegação">
      <button class="tab-btn active" type="button" data-tab="tab-orcamento">Orçamento</button>
      <button class="tab-btn" type="button" data-tab="tab-estoque">Estoque</button>
    </nav>

    <!-- =========================
         ABA: ORÇAMENTO
    ========================== -->
    <div id="tab-orcamento" class="tab-content">
      <!-- DADOS DO CLIENTE E SERVIÇO -->
      <section class="card">
        <h2>Dados do Cliente e Serviço</h2>

        <div class="form-grid">
          <div class="form-group">
            <label for="cliente">Nome do Cliente</label>
            <input type="text" id="cliente" placeholder="Ex: João da Silva" />
          </div>

          <div class="form-group">
            <label for="telefone">Telefone / WhatsApp</label>
            <input type="text" id="telefone" placeholder="Ex: (31) 99999-9999" />
          </div>

          <div class="form-group">
            <label for="cpfCnpj">CPF/CNPJ (opcional)</label>
            <input type="text" id="cpfCnpj" placeholder="Ex: 123.456.789-00" />
          </div>

          <div class="form-group">
            <label for="placa">Placa</label>
            <input type="text" id="placa" placeholder="Ex: ABC1D23" />
          </div>

          <div class="form-group">
            <label for="modelo">Modelo</label>
            <input type="text" id="modelo" placeholder="Ex: Gol 1.6 / Onix / Corolla" />
          </div>

          <div class="form-group">
            <label for="ano">Ano</label>
            <input type="number" id="ano" min="1900" max="2100" placeholder="Ex: 2016" />
          </div>

          <div class="form-group">
            <label for="km">KM</label>
            <input type="number" id="km" min="0" step="1" placeholder="Ex: 125000" />
          </div>

          <div class="form-group" style="grid-column: 1 / -1;">
            <label for="descricao">Descrição do Serviço</label>
            <textarea id="descricao" rows="2" placeholder="Ex: Revisão geral, troca de óleo, diagnóstico elétrico..."></textarea>
          </div>

          <div class="form-group">
            <label for="maoDeObra">Valor da Mão de Obra (R$)</label>
            <input type="number" id="maoDeObra" min="0" step="0.01" placeholder="Ex: 250.00" />
          </div>
        </div>

        <p id="erroPrincipal" class="error-msg"></p>
      </section>

      <!-- PEÇAS DO ORÇAMENTO -->
      <section class="card">
        <h2>Peças Utilizadas</h2>

        <!-- datalist para autocomplete do estoque -->
        <datalist id="estoqueSugestoes"></datalist>

        <div class="parts-grid">
          <div class="form-group">
            <label for="nomePeca">Nome da peça</label>
            <input type="text" id="nomePeca" list="estoqueSugestoes" placeholder="Ex: Filtro de óleo" />
          </div>

          <div class="form-group">
            <label for="qtdPeca">Quantidade</label>
            <input type="number" id="qtdPeca" min="1" step="1" placeholder="Ex: 1" />
          </div>

          <div class="form-group">
            <label for="valorPeca">Valor unitário (R$)</label>
            <input type="number" id="valorPeca" min="0" step="0.01" placeholder="Ex: 45.90" />
          </div>
        </div>

        <button id="btnAdicionarPeca" class="btn secondary">Adicionar peça</button>
        <p id="erroPeca" class="error-msg"></p>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Peça</th>
                <th>Qtd</th>
                <th>Unitário (R$)</th>
                <th>Total (R$)</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody id="tabelaPecas"></tbody>
          </table>
        </div>

        <div class="totals-row">
          <span>Total de peças:</span>
          <strong id="totalPecas">R$ 0,00</strong>
        </div>
      </section>

      <!-- AÇÕES -->
      <section class="card actions-card">
        <h2>Ações</h2>
        <div class="actions">
          <button id="btnGerar" class="btn primary">Gerar Orçamento</button>
          <button id="btnSalvar" class="btn success">Salvar Orçamento</button>
          <button id="btnLimpar" class="btn danger">Limpar Tudo</button>
        </div>
        <p id="mensagemAcao" class="info-msg"></p>
      </section>

      <!-- ORÇAMENTO GERADO -->
      <section class="card" id="cardOrcamento" hidden>
        <h2>Orçamento Gerado</h2>

        <div class="orcamento-header">
          <div>
            <p><strong>Cliente:</strong> <span id="orcCliente"></span></p>
            <p><strong>Serviço:</strong> <span id="orcDescricao"></span></p>
          </div>
          <div>
            <p><strong>Data:</strong> <span id="orcData"></span></p>
          </div>
        </div>

        <h3>Peças</h3>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Peça</th>
                <th>Qtd</th>
                <th>Unitário (R$)</th>
                <th>Total (R$)</th>
              </tr>
            </thead>
            <tbody id="orcPecas"></tbody>
          </table>
        </div>

        <div class="orcamento-totals">
          <p><strong>Total peças:</strong> <span id="orcTotalPecas"></span></p>
          <p><strong>Mão de obra:</strong> <span id="orcMaoDeObra"></span></p>
          <p class="grand-total"><strong>Total geral:</strong> <span id="orcTotalGeral"></span></p>
        </div>

        <div class="actions" style="margin-top: 0.75rem;">
          <button id="btnPDF" class="btn secondary">Baixar PDF</button>
        </div>
      </section>

      <!-- ÚLTIMO ORÇAMENTO -->
      <section class="card" id="cardUltimoOrcamento" hidden>
        <h2>Último orçamento salvo</h2>
        <p>Encontramos um orçamento salvo anteriormente.</p>
        <button id="btnCarregarUltimo" class="btn secondary">Carregar orçamento salvo</button>
      </section>
    </div>

    <!-- =========================
         ABA: ESTOQUE
    ========================== -->
    <div id="tab-estoque" class="tab-content" hidden>
      <!-- CONTROLE DE ESTOQUE -->
      <section class="card" id="cardEstoque">
        <h2>Controle de Estoque</h2>

        <div class="form-grid">
          <div class="form-group">
            <label for="estNome">Peça</label>
            <input id="estNome" type="text" placeholder="Ex: Filtro de óleo" />
          </div>

          <div class="form-group">
            <label for="estSku">SKU/Código</label>
            <input id="estSku" type="text" placeholder="Ex: FO-123" />
          </div>

          <div class="form-group">
            <label for="estCat">Categoria</label>
            <input id="estCat" type="text" placeholder="Ex: Filtros" />
          </div>

          <div class="form-group">
            <label for="estCusto">Custo (R$)</label>
            <input id="estCusto" type="number" step="0.01" min="0" placeholder="Ex: 25.00" />
          </div>

          <div class="form-group">
            <label for="estPreco">Preço (R$)</label>
            <input id="estPreco" type="number" step="0.01" min="0" placeholder="Ex: 45.90" />
          </div>

          <div class="form-group">
            <label for="estQtd">Qtd</label>
            <input id="estQtd" type="number" step="1" min="0" placeholder="Ex: 10" />
          </div>

          <div class="form-group">
            <label for="estMin">Estoque mínimo</label>
            <input id="estMin" type="number" step="1" min="0" placeholder="Ex: 2" />
          </div>
        </div>

        <div class="actions-card" style="padding:0; border:none; box-shadow:none; margin-top: 0.75rem;">
          <div class="actions">
            <button id="btnAddItem" class="btn primary" type="button">Adicionar/Atualizar</button>
            <button id="btnExportEstoque" class="btn secondary" type="button">Salvar Backup</button>
            <label class="btn secondary" style="cursor:pointer;">
              Restaurar Backup
              <input id="importEstoque" type="file" accept="application/json" style="display:none;" />
            </label>
          </div>
        </div>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Peça</th>
                <th>SKU</th>
                <th>Categoria</th>
                <th>Qtd</th>
                <th>Preço</th>
                <th>Mín</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody id="tbodyEstoque"></tbody>
          </table>
        </div>

        <p id="msgEstoque" class="info-msg"></p>
      </section>
    </div>

  </main>

  <footer class="footer">
    <p>MecPrice • desenvolvido para oficinas e autoelétricas que querem orçar com profissionalismo.</p>
  </footer>

  <!-- jsPDF + AutoTable (PDF) -->
  <script src="libs/jspdf.umd.min.js"></script>
  <script src="libs/jspdf.plugin.autotable.min.js"></script>

  <!-- Script principal do MecPrice -->
  <script src="script.js"></script>
</body>
</html>
