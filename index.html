<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>MecPrice - Orçamento + Estoque</title>

    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#f7c948" />

    <link rel="stylesheet" href="style.css" />

    <!-- (mantive o seu bloco de analytics / tags exatamente como estava no arquivo) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2ZPMXW0E3H"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-2ZPMXW0E3H');
    </script>
</head>

<body>
    <header class="topbar">
        <div class="brand">
            <span class="logo">M</span>
            <div class="brand-text">
                <h1>MecPrice</h1>
                <small>Orçamento + Estoque (PWA)</small>
            </div>
        </div>

        <nav class="tabs">
            <button class="tab-btn active" type="button" data-tab="tab-orcamento">Orçamento</button>
            <button class="tab-btn" type="button" data-tab="tab-estoque">Estoque</button>
        </nav>
    </header>

    <main class="container">

        <!-- =========================
             ABA: ORÇAMENTO
        ========================== -->
        <div id="tab-orcamento" class="tab-content">

            <section class="card">
                <h2>Dados do Cliente e Serviço</h2>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="cliente">Nome do Cliente</label>
                        <input type="text" id="cliente" placeholder="Ex: João da Silva" />
                    </div>

                    <div class="form-group">
                        <label for="telefone">Telefone / WhatsApp</label>
                        <input type="text" id="telefone" placeholder="Ex: (31) 99999-9999" />
                    </div>

                    <div class="form-group">
                        <label for="cpfCnpj">CPF/CNPJ</label>
                        <input type="text" id="cpfCnpj" placeholder="Ex: 000.000.000-00" />
                    </div>

                    <div class="form-group">
                        <label for="placa">Placa</label>
                        <input type="text" id="placa" placeholder="Ex: ABC1D23" />
                    </div>

                    <div class="form-group">
                        <label for="modelo">Modelo</label>
                        <input type="text" id="modelo" placeholder="Ex: Gol 1.6" />
                    </div>

                    <div class="form-group">
                        <label for="ano">Ano</label>
                        <input type="number" id="ano" min="1900" max="2100" placeholder="Ex: 2016" />
                    </div>

                    <div class="form-group">
                        <label for="km">KM</label>
                        <input type="number" id="km" min="0" step="1" placeholder="Ex: 125000" />
                    </div>

                    <div class="form-group" style="grid-column:1 / -1;">
                        <label for="descricao">Observações</label>
                        <textarea id="descricao" rows="2" placeholder="Ex: Revisão geral, troca de óleo..."></textarea>
                    </div>
                </div>
            </section>

            <section class="card">
                <h2>Serviços</h2>

                <div class="form-grid">
                    <div class="field field-wide">
                        <label for="servNome">Serviço</label>
                        <input id="servNome" type="text"
                            placeholder="Ex: Troca de óleo / Diagnóstico / Regulagem de válvulas" />
                    </div>

                    <div class="field">
                        <label for="servQtd">Quantidade</label>
                        <input id="servQtd" type="number" min="1" step="1" value="1" />
                    </div>

                    <div class="field">
                        <label for="servValor">Valor (R$)</label>
                        <input id="servValor" type="number" min="0" step="0.01" placeholder="Ex: 150.00" />
                    </div>
                </div>

                <button id="btnAddServico" class="btn" type="button">Adicionar serviço</button>

                <div class="table-wrap">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Serviço</th>
                                <th>Qtd</th>
                                <th>Unitário (R$)</th>
                                <th>Total (R$)</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyServicos"></tbody>
                    </table>
                </div>

                <div class="totals">
                    <span>Total serviços: <strong id="totalServicos">R$ 0,00</strong></span>
                </div>
            </section>

            <p id="erroPrincipal" class="error-msg"></p>

            <section class="card">
                <h2>Peças Utilizadas</h2>

                <datalist id="estoqueSugestoes"></datalist>

                <div class="parts-grid">
                    <div class="form-group">
                        <label for="nomePeca">Nome da peça</label>
                        <input type="text" id="nomePeca" list="estoqueSugestoes" placeholder="Ex: Filtro de óleo" />
                    </div>

                    <div class="form-group">
                        <label for="qtdPeca">Qtd</label>
                        <input type="number" id="qtdPeca" min="1" step="1" placeholder="Ex: 1" />
                    </div>

                    <div class="form-group">
                        <label for="valorPeca">Valor unitário (R$)</label>
                        <input type="number" id="valorPeca" min="0" step="0.01" placeholder="Ex: 35.90" />
                    </div>

                    <div class="form-group" style="align-self:end;">
                        <button id="btnAdicionarPeca" class="btn" type="button">Adicionar peça</button>
                    </div>
                </div>

                <p id="erroPeca" class="error-msg"></p>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Peça</th>
                                <th>Qtd</th>
                                <th>Unitário</th>
                                <th>Total</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaPecas"></tbody>
                    </table>
                </div>

                <div class="totals">
                    <span>Total peças: <strong id="totalPecas">R$ 0,00</strong></span>
                </div>
            </section>

            <div class="actions">
                <button id="btnGerar" class="btn primary" type="button">Gerar orçamento</button>
                <button id="btnSalvar" class="btn secondary" type="button">Salvar orçamento</button>
                <button id="btnLimpar" class="btn danger" type="button">Limpar</button>
            </div>

            <p id="mensagemAcao" class="info-msg"></p>

            <section class="card" id="cardOrcamento" hidden>
                <h2>Orçamento Gerado</h2>

                <div class="orcamento-header">
                    <div>
                        <p><strong>Cliente:</strong> <span id="orcCliente"></span></p>
                        <p><strong>Observações:</strong> <span id="orcDescricao"></span></p>
                    </div>
                    <div>
                        <p><strong>Data:</strong> <span id="orcData"></span></p>
                    </div>
                </div>

                <h3>Serviços</h3>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Serviço</th>
                                <th>Qtd</th>
                                <th>Unitário</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody id="orcServicos"></tbody>
                    </table>
                </div>

                <h3>Peças</h3>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Peça</th>
                                <th>Qtd</th>
                                <th>Unitário</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody id="orcPecas"></tbody>
                    </table>
                </div>

                <div class="orcamento-totals">
                    <p><strong>Total serviços:</strong> <span id="orcTotalServicos"></span></p>
                    <p><strong>Total peças:</strong> <span id="orcTotalPecas"></span></p>
                    <p class="grand-total"><strong>Total geral:</strong> <span id="orcTotalGeral"></span></p>
                </div>

                <div class="actions" style="margin-top: 0.75rem;">
                    <button id="btnPDF" class="btn secondary" type="button">Baixar PDF</button>
                </div>
            </section>

            <section class="card" id="cardUltimoOrcamento" hidden>
                <h2>Último orçamento salvo</h2>
                <p>Encontramos um orçamento salvo anteriormente.</p>
                <button id="btnCarregarUltimo" class="btn secondary" type="button">Carregar orçamento salvo</button>
            </section>
        </div>

        <!-- =========================
             ABA: ESTOQUE
        ========================== -->
        <div id="tab-estoque" class="tab-content" hidden>

            <section class="card">
                <h2>Controle de Estoque</h2>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="estNome">Nome</label>
                        <input type="text" id="estNome" placeholder="Ex: Filtro de óleo" />
                    </div>

                    <div class="form-group">
                        <label for="estSku">SKU (opcional)</label>
                        <input type="text" id="estSku" placeholder="Ex: FO-123" />
                    </div>

                    <div class="form-group">
                        <label for="estCat">Categoria (opcional)</label>
                        <input type="text" id="estCat" placeholder="Ex: Lubrificação" />
                    </div>

                    <div class="form-group">
                        <label for="estCusto">Custo (R$)</label>
                        <input type="number" id="estCusto" min="0" step="0.01" placeholder="Ex: 20.00" />
                    </div>

                    <div class="form-group">
                        <label for="estPreco">Preço (R$)</label>
                        <input type="number" id="estPreco" min="0" step="0.01" placeholder="Ex: 35.90" />
                    </div>

                    <div class="form-group">
                        <label for="estQtd">Quantidade</label>
                        <input type="number" id="estQtd" min="0" step="1" placeholder="Ex: 10" />
                    </div>

                    <div class="form-group">
                        <label for="estMin">Estoque mínimo</label>
                        <input type="number" id="estMin" min="0" step="1" placeholder="Ex: 2" />
                    </div>

                    <div class="form-group" style="align-self:end;">
                        <button id="btnAddItem" class="btn" type="button">Adicionar/Atualizar</button>
                    </div>
                </div>

                <div class="actions" style="margin-top: 1rem;">
                    <button id="btnExportEstoque" class="btn secondary" type="button">Salvar Backup</button>
                    <label class="btn secondary" style="cursor:pointer;">
                        Restaurar Backup
                        <input id="importEstoque" type="file" accept=".json" hidden />
                    </label>
                </div>

                <p id="msgEstoque" class="info-msg"></p>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>SKU</th>
                                <th>Categoria</th>
                                <th>Custo</th>
                                <th>Preço</th>
                                <th>Qtd</th>
                                <th>Mín</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyEstoque"></tbody>
                    </table>
                </div>
            </section>
        </div>

    </main>

    <!-- Scripts -->
    <script src="libs/core.js"></script>
    <script src="libs/storage.js"></script>
    <script src="libs/dom.js"></script>
    <script src="libs/tabs.js"></script>
    <script src="libs/estoque.js"></script>
    <script src="libs/orcamento.js"></script>
    <script src="libs/pdf.js"></script>
    <script src="libs/validators.js"></script>
    <script src="libs/pro-modal.js"></script>
    <script src="app.js"></script>
</body>

</html>